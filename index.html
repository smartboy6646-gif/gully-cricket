<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Gully Cricket Scorer - Ultimate</title>
    <style>
        :root { --primary: #0d47a1; --accent: #ffeb3b; --bg: #f5f5f5; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 10px; display: flex; justify-content: center; }
        .app-card { width: 100%; max-width: 500px; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; min-height: 98vh; overflow: hidden; }
        
        #setup-screen { position: fixed; inset: 0; background: white; z-index: 2000; padding: 25px; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
        .header { background: var(--primary); color: white; padding: 15px; text-align: center; }
        .score-box { font-size: 3rem; font-weight: bold; margin: 10px 0; }
        
        .match-info { background: rgba(0,0,0,0.1); padding: 10px; border-radius: 8px; display: flex; justify-content: space-around; font-size: 0.9rem; }
        .striker { color: var(--accent); font-weight: bold; text-decoration: underline; }

        .table-area { padding: 10px; flex-grow: 1; overflow-y: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 0.8rem; margin-bottom: 20px; }
        th { background: #eee; padding: 6px; text-align: left; }
        td { padding: 6px; border-bottom: 1px solid #ddd; }

        .controls { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 10px; background: #eee; }
        button { padding: 15px 5px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-run { background: white; }
        .btn-w { background: #d32f2f; color: white; grid-column: span 2; }
        .btn-f { background: #2e7d32; color: white; grid-column: span 4; margin-top: 5px; }
    </style>
</head>
<body>

<div id="setup-screen">
    <h2>üèè Match Setup</h2>
    <input type="text" id="t1" placeholder="Team 1 Name" value="Team A">
    <input type="text" id="t2" placeholder="Team 2 Name" value="Team B">
    <select id="toss-win"><option value="1">Team 1 won Toss</option><option value="2">Team 2 won Toss</option></select>
    <select id="toss-choice"><option value="bat">Batting First</option><option value="bowl">Bowling First</option></select>
    <hr>
    <input type="text" id="s1" placeholder="Striker Name">
    <input type="text" id="s2" placeholder="Non-Striker Name">
    <input type="text" id="bwl" placeholder="Bowler Name">
    <button onclick="startMatch()" style="padding:15px; background:var(--primary); color:white; border-radius:8px;">PLAY NOW</button>
</div>

<div class="app-card">
    <div class="header">
        <h3 id="batting-team-title" style="margin:0">TEAMS</h3>
        <div class="score-box" id="main-score">0 - 0</div>
        <div id="overs-txt">Overs: 0.0</div>
        <div class="match-info">
            <div id="s-display">Striker: -</div>
            <div id="ns-display">Non-Striker: -</div>
        </div>
        <div style="margin-top:10px;">Current Bowler: <b id="bwl-display">-</b></div>
    </div>

    <div class="table-area">
        <h4>Batsmen Scorecard</h4>
        <table id="bat-table">
            <thead><tr><th>Name</th><th>R</th><th>B</th><th>SR</th></tr></thead>
            <tbody></tbody>
        </table>

        <h4>Bowlers Scorecard</h4>
        <table id="bwl-table">
            <thead><tr><th>Name</th><th>O</th><th>R</th><th>W</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div class="controls">
        <button class="btn-run" onclick="addRun(0)">0</button>
        <button class="btn-run" onclick="addRun(1)">1</button>
        <button class="btn-run" onclick="addRun(2)">2</button>
        <button class="btn-run" onclick="addRun(3)">3</button>
        <button class="btn-run" style="background:#fff176" onclick="addRun(4)">4</button>
        <button class="btn-run" style="background:#ffb300" onclick="addRun(6)">6</button>
        <button class="btn-run" style="background:#ffccbc" onclick="extra('WD')">WD</button>
        <button class="btn-run" style="background:#ffccbc" onclick="extra('NB')">NB</button>
        <button class="btn-w" onclick="wicket()">WICKET</button>
        <button class="btn-f" onclick="inningsBreak()">FINISH INNINGS</button>
    </div>
</div>

<script>
    let data = {
        teams: [], batting: "", score: 0, wickets: 0, balls: 0,
        striker: "", nonStriker: "", bowler: "",
        batsmen: {}, // {name: {r, b, out}}
        bowlers: {}, // {name: {o:balls, r, w}}
        bowlerList: [], // for suggestions
        inn: 1
    };

    function startMatch() {
        data.teams = [document.getElementById('t1').value, document.getElementById('t2').value];
        let toss = document.getElementById('toss-win').value;
        let choice = document.getElementById('toss-choice').value;

        if (toss == "1") data.batting = (choice == 'bat') ? data.teams[0] : data.teams[1];
        else data.batting = (choice == 'bat') ? data.teams[1] : data.teams[0];

        data.striker = document.getElementById('s1').value || "Bat 1";
        data.nonStriker = document.getElementById('s2').value || "Bat 2";
        data.bowler = document.getElementById('bwl').value || "Bowl 1";

        initBat(data.striker); initBat(data.nonStriker); initBwl(data.bowler);
        document.getElementById('setup-screen').style.display = 'none';
        updateUI();
    }

    function initBat(n) { if (!data.batsmen[n]) data.batsmen[n] = {r:0, b:0, out:false}; }
    function initBwl(n) { 
        if (!data.bowlers[n]) {
            data.bowlers[n] = {o:0, r:0, w:0};
            data.bowlerList.push(n);
        }
    }

    function addRun(r) {
        data.score += r;
        data.balls++;
        data.batsmen[data.striker].r += r;
        data.batsmen[data.striker].b++;
        data.bowlers[data.bowler].r += r;
        data.bowlers[data.bowler].o++;

        if (r % 2 !== 0) rotate();
        checkOver();
        updateUI();
    }

    function extra(type) {
        data.score += 1;
        data.bowlers[data.bowler].r += 1;
        updateUI();
    }

    function rotate() {
        let t = data.striker; data.striker = data.nonStriker; data.nonStriker = t;
    }

    function checkOver() {
        if (data.balls > 0 && data.balls % 6 === 0) {
            rotate();
            updateUI();
            setTimeout(() => {
                let msg = "Current Bowlers: " + data.bowlerList.join(", ") + "\nType name for NEW or select EXISTING:";
                let nextB = prompt(msg, data.bowler);
                if (nextB) {
                    data.bowler = nextB;
                    initBwl(nextB);
                }
                updateUI();
            }, 200);
        }
    }

    function wicket() {
        data.wickets++;
        data.balls++;
        data.batsmen[data.striker].b++;
        data.batsmen[data.striker].out = true;
        data.bowlers[data.bowler].o++;
        data.bowlers[data.bowler].w++;
        
        updateUI();
        if (data.wickets < 10) {
            setTimeout(() => {
                let nextBat = prompt("Who is the new batsman?");
                if (nextBat) {
                    data.striker = nextBat;
                    initBat(nextBat);
                }
                updateUI();
            }, 200);
        } else {
            inningsBreak();
        }
    }

    function updateUI() {
        document.getElementById('batting-team-title').innerText = data.batting;
        document.getElementById('main-score').innerText = `${data.score} - ${data.wickets}`;
        document.getElementById('overs-txt').innerText = `Overs: ${Math.floor(data.balls/6)}.${data.balls%6}`;
        document.getElementById('s-display').innerHTML = `<span class="striker">${data.striker}</span>: ${data.batsmen[data.striker].r}(${data.batsmen[data.striker].b})`;
        document.getElementById('ns-display').innerText = `${data.nonStriker}: ${data.batsmen[data.nonStriker].r}(${data.batsmen[data.nonStriker].b})`;
        document.getElementById('bwl-display').innerText = data.bowler;

        // Batsmen Table
        let bHtml = "";
        for (let b in data.batsmen) {
            let row = data.batsmen[b];
            let sr = row.b > 0 ? ((row.r/row.b)*100).toFixed(1) : 0;
            bHtml += `<tr><td>${b}${row.out?' (o)':'*'}</td><td>${row.r}</td><td>${row.b}</td><td>${sr}</td></tr>`;
        }
        document.querySelector('#bat-table tbody').innerHTML = bHtml;

        // Bowler Table
        let boHtml = "";
        for (let b in data.bowlers) {
            let row = data.bowlers[b];
            let ov = `${Math.floor(row.o/6)}.${row.o%6}`;
            boHtml += `<tr><td>${b}</td><td>${ov}</td><td>${row.r}</td><td>${row.w}</td></tr>`;
        }
        document.querySelector('#bwl-table tbody').innerHTML = boHtml;
    }

    function inningsBreak() {
        if (data.inn === 1) {
            alert("1st Innings Finished! Target: " + (data.score + 1));
            data.inn = 2;
            data.score = 0; data.wickets = 0; data.balls = 0;
            data.batting = (data.batting === data.teams[0]) ? data.teams[1] : data.teams[0];
            document.getElementById('setup-screen').style.display = 'flex';
            data.striker = ""; data.nonStriker = ""; 
        } else {
            let topRun = -1; let mom = "";
            for (let b in data.batsmen) {
                if (data.batsmen[b].r > topRun) { topRun = data.batsmen[b].r; mom = b; }
            }
            alert("Match Over! Man of the Match: " + mom + " (" + topRun + " Runs)");
            location.reload();
        }
    }
</script>
</body>
</html>
